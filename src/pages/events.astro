---
import { getCollection, render } from 'astro:content'
import BaseLayout from '../layouts/BaseLayout.astro'

const events = await getCollection('events')
const sortedEvents = events.sort(
  (a, b) => (a.data.order || 0) - (b.data.order || 0)
)

// Render all events to get their Content components
const renderedEvents = await Promise.all(
  sortedEvents.map(async (event) => ({
    ...event,
    Content: (await render(event)).Content
  }))
)
---

<BaseLayout
  title="Events - Interledger Foundation"
  description="Create space to be inspired"
>
  <main class="pb-space-xl">
    <section
      class="py-space-xl text-center text-white max-[799px]:py-space-l"
      style="background: linear-gradient(135deg, oklch(35% 0.12 200) 0%, oklch(45% 0.1 190) 30%, oklch(50% 0.08 180) 60%, oklch(55% 0.06 170) 100%);"
    >
      <div class="mx-auto max-w-content min-w-[360px] max-[1324px]:px-[5%]">
        <h1 class="mb-space-xs text-step-6 font-bold drop-shadow-[0_2px_20px_rgba(0,0,0,0.3)] max-[799px]:text-step-4">
          Events
        </h1>
        <p class="text-step-2 font-light italic opacity-95 max-[799px]:text-step-0">
          Create space to be inspired
        </p>
      </div>
    </section>

    <section
      class="py-space-xl max-[799px]:py-space-l"
      style="background: radial-gradient(circle at 30% 20%, rgba(255, 148, 128, 0.25), transparent 45%), radial-gradient(circle at 80% 10%, rgba(111, 181, 255, 0.3), transparent 40%), linear-gradient(180deg, #f7f8fb 0%, #f1f7f8 50%, #f7f8fb 100%);"
    >
      <div class="mx-auto max-w-content min-w-[360px] max-[1324px]:px-[5%]">
        <div class="flex flex-col gap-space-l">
          {
            renderedEvents.map((event, index) => {
              const hasImage = Boolean(event.data.featuredImage)
              const isReverse = index % 2 === 1
              return (
                <article
                  class={`grid items-center gap-space-l rounded-[18px] bg-white/90 p-space-l shadow-[0_18px_40px_rgba(0,0,0,0.08)] max-[799px]:grid-cols-1 max-[799px]:gap-space-m max-[799px]:p-space-m ${hasImage ? 'grid-cols-[1.05fr_0.95fr]' : 'grid-cols-1'}`}
                >
                  <div class={isReverse ? 'order-2 max-[799px]:order-none' : ''}>
                    <h2 class="mb-space-s text-step-4 max-[799px]:text-step-3">
                      {event.data.title}
                    </h2>
                    <div class="text-step-0 leading-[1.8] text-black [&_p]:mb-space-s [&_h3]:mt-space-m [&_h3]:mb-space-2xs [&_h3]:text-step-1 [&_h3]:font-semibold [&_ul]:my-space-s [&_ol]:my-space-s [&_ul]:ps-space-m [&_ol]:ps-space-m [&_li]:mb-space-2xs [&_a]:font-semibold [&_a]:text-primary [&_strong]:font-bold [&_strong]:text-inherit [&_em]:text-inherit">
                      <event.Content />
                    </div>
                  </div>
                  {hasImage && (
                    <div
                      class={`relative overflow-hidden rounded-[14px] shadow-[0_12px_28px_rgba(0,0,0,0.12)] max-[799px]:max-h-[280px] ${isReverse ? 'order-1 max-[799px]:order-none' : ''}`}
                    >
                      <img
                        src={event.data.featuredImage}
                        alt={event.data.title}
                        loading="lazy"
                        class="h-full w-full object-cover"
                      />
                    </div>
                  )}
                </article>
              )
            })
          }
        </div>
      </div>
    </section>
  </main>
</BaseLayout>
