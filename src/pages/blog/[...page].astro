---
import { getCollection } from 'astro:content'
import type { GetStaticPaths, Page } from 'astro'
import Pagination from '@/components/blog/Pagination.astro'
import BaseLayout from '@/layouts/BaseLayout.astro'
import { createExcerpt } from '@/utils/create-excerpt'

type Props = {
  page: Page
}

export const prerender = true

export const getStaticPaths: GetStaticPaths = async ({ paginate }) => {
  const blogEntries = (await getCollection('foundation-blog')).sort(
    (a, b) => b.data.date.getTime() - a.data.date.getTime()
  )
  return paginate(blogEntries, { pageSize: 10 })
}

const { page } = Astro.props
---

<BaseLayout
  title="Engineering Blog"
  description="Hear stories and experiences from the team who is working on making Interledger, the interoperable global payments network, a reality."
  ogImageUrl={new URL('/img/blog/og-image.png', Astro.site).href}
>
  <main class="pt-space-m pb-space-xl">
    <div class="mx-auto max-w-content min-w-[360px] max-[1324px]:px-[5%]">
      <ol
        class="flex list-none ps-0 text-step--1 font-bold pt-space-l [&_a]:text-primary [&_a]:no-underline"
        itemscope
        itemtype="https://schema.org/BreadcrumbList"
      >
        <li
          itemprop="itemListElement"
          itemscope
          itemtype="https://schema.org/ListItem"
        >
          <a itemprop="item" href="/" data-umami-event="Devs breadcrumb - Home">
            <span itemprop="name">Developers Portal</span></a
          >
          <meta itemprop="position" content="1" />
        </li>
      </ol>
      <header
        class="pt-space-s pb-space-m flex justify-between items-center gap-space-xs max-[730px]:flex-col max-[730px]:items-start"
      >
        <h1>Engineering Blog</h1>
        <a
          class="group flex items-center gap-space-s rounded bg-white px-space-2xs py-space-3xs shadow text-step--1 no-underline"
          href="/blog"
        >
          <p
            class="underline decoration-transparent transition-[text-decoration-color] duration-300 group-hover:decoration-current"
          >
            Check out Foundation updates
          </p>
          <img
            src="/img/ernie-purple.svg"
            alt="Ernie holding an envelope"
            aria-hidden="true"
            class="w-[4em]"
          />
        </a>
      </header>
      <ol class="list-none p-0">
        {
          (page.data || []).map((blogPostEntry) => {
            const excerpt = `${createExcerpt(blogPostEntry.body).substring(0, 300)}...`
            return (
              <li class="flex flex-row gap-space-m mb-space-m p-space-m bg-white/50 rounded shadow max-[768px]:flex-col">
                <div class="flex-shrink-0">
                  {blogPostEntry.data.thumbnailImage && (
                    <img
                      loading="lazy"
                      src={blogPostEntry.data.thumbnailImage}
                      width="250"
                      height="250"
                      alt={blogPostEntry.data.thumbnailImageAlt}
                      class="w-[250px] h-[250px] object-cover rounded max-[768px]:w-full max-[768px]:h-auto"
                    />
                  )}
                </div>
                <div class="flex flex-col flex-1">
                  {blogPostEntry.data.lang ? (
                    <div class="flex items-start gap-space-2xs">
                      <h2 class="mb-space-3xs">
                        <a
                          href={`/blog/${blogPostEntry.id}`}
                          class="text-primary font-semibold no-underline transition-colors duration-300 hover:underline"
                        >
                          {blogPostEntry.data.title}
                        </a>
                      </h2>
                      <a
                        class="mt-space-3xs rounded border-[1.5px] bg-white px-[4px] text-step--1 no-underline"
                        href="/blog/es"
                      >
                        ES
                      </a>
                    </div>
                  ) : (
                    <h2 class="mb-space-3xs">
                      <a
                        href={`/blog/${blogPostEntry.id}`}
                        class="text-primary font-semibold no-underline transition-colors duration-300 hover:underline"
                      >
                        {blogPostEntry.data.title}
                      </a>
                    </h2>
                  )}
                  <time
                    class="block text-step--1 mb-space-2xs"
                    datetime={blogPostEntry.data.date.toISOString()}
                  >
                    {blogPostEntry.data.date.toDateString().substring(4)}
                  </time>
                  <p class="mb-space-2xs flex-grow">
                    {blogPostEntry.data.description
                      ? blogPostEntry.data.description
                      : excerpt}
                  </p>
                  <a
                    href={`/blog/${blogPostEntry.id}`}
                    class="self-start text-primary font-semibold no-underline transition-opacity duration-300 hover:opacity-80"
                  >
                    Read more â†’
                  </a>
                </div>
              </li>
            )
          })
        }
      </ol>
      <Pagination
        length={page.lastPage}
        currentPage={page.currentPage}
        firstUrl={page.url.first}
        prevUrl={page.url.prev}
        nextUrl={page.url.next}
        lastUrl={page.url.last}
      />
    </div>
  </main>
</BaseLayout>
