---
/**
 * Ambassadors Grid Block for Dynamic Zones (SSR Preview)
 * Renders the ambassadors selected by content authors in Strapi
 * Converts markdown descriptions to HTML for preview rendering
 */

import AmbassadorGrid from '../ambassadors/AmbassadorGrid.astro'
import { parseMarkdown } from '../../utils/mdx'
import type { StrapiAmbassador, AmbassadorData } from '../ambassadors/types'

interface Props {
  heading?: string
  ambassadors?: StrapiAmbassador[]
}

const { heading, ambassadors: strapiAmbassadors = [] } = Astro.props

// Transform Strapi ambassador data to the format expected by AmbassadorGrid
// Convert markdown description to HTML for preview rendering
const ambassadors: AmbassadorData[] = await Promise.all(
  strapiAmbassadors.map(async (amb) => ({
    name: amb.name,
    slug: amb.slug,
    description: await parseMarkdown(amb.description || ''),
    photo: amb.photo?.url || null,
    photoAlt: amb.name,
    linkedinUrl: amb.linkedinUrl,
    grantReportUrl: amb.grantReportUrl
  }))
)
---

{
  ambassadors.length > 0 ? (
    <AmbassadorGrid ambassadors={ambassadors} heading={heading} />
  ) : (
    <p class="text-gray">No ambassadors selected for this grid.</p>
  )
}
